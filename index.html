<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>首页</title>
  <link rel="stylesheet" href="./bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="./css/index.css">
  <link rel="stylesheet" href="./css/swiper.min.css">
</head>
<body>
  <div class="container-fluid-home">
    <div class="videos">
      <video id="video0" class="video" src="./videos/first.mp4" style="display: block;">
        您的浏览器不支持video标签，请升级浏览器再浏览本页面！<a href="./videos/first.mp4">视频地址</a>
      </video>
      <video src="./videos/second.mp4" id="video1" class="video">
        您的浏览器不支持video标签，请升级浏览器再浏览本页面！<a href="./videos/second.mp4">视频地址</a>
      </video>
      <video src="./videos/three.mp4" id="video2" class="video">
        您的浏览器不支持video标签，请升级浏览器再浏览本页面！<a href="./videos/three.mp4">视频地址</a>
      </video>
      <video src="./videos/four.mp4" id="video3" class="video">
        您的浏览器不支持video标签，请升级浏览器再浏览本页面！<a href="./videos/four.mp4">视频地址</a>
      </video>
      <video id="reversevideo0" class="reversevideo" src="./videos/refirst.mp4" style="display: block;">
        您的浏览器不支持video标签，请升级浏览器再浏览本页面！<a href="./videos/refirst.mp4">视频地址</a>
      </video>
      <video src="./videos/resecond.mp4" id="reversevideo1" class="reversevideo">
        您的浏览器不支持video标签，请升级浏览器再浏览本页面！<a href="./videos/resecond.mp4">视频地址</a>
      </video>
      <video src="./videos/rethree.mp4" id="reversevideo2" class="reversevideo">
        您的浏览器不支持video标签，请升级浏览器再浏览本页面！<a href="./videos/rethree.mp4">视频地址</a>
      </video>
      <video src="./videos/refour.mp4" id="reversevideo3" class="reversevideo">
        您的浏览器不支持video标签，请升级浏览器再浏览本页面！<a href="./videos/refour.mp4">视频地址</a>
      </video>
    </div>
    <div class="swiper-container-wrapper">
      <!-- Swiper -->
      <div class="swiper-container">
        <div class="swiper-wrapper">
          <div class="swiper-slide">
            <div class="first swiper-img">
              <img src="./images/first.jpg" width="100%" alt="">
            </div>
          </div>
          <div class="swiper-slide">
            <div class="first swiper-img">
              <img src="./images/second.jpg" width="100%" alt="">
            </div>
          </div>
          <div class="swiper-slide">
            <div class="first swiper-img">
              <img src="./images/three.jpg" width="100%" alt="">
            </div>
          </div>
          <div class="swiper-slide">
            <div class="first swiper-img">
              <img src="./images/four.jpg" width="100%" alt="">
            </div>
          </div>
        </div>
        <!-- Add Pagination -->
        <div class="swiper-pagination"></div>
      </div>
    </div>

  </div>
  <nav class="navbar navbar-shell navbar-fixed-bottom">
    <div class="container-fluid">
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand navbar-brand-shell" href="./index.html">浙江壳牌燃油有限公司</a>
      </div>
      <!-- Collect the nav links -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav navbar-right">
          <li class="active">
            <a href="./index.html">
              <div>
                <p>HOME</p>
                <p>首页</p>
              </div>
            </a>
          </li>
          <li>
            <a href="./story.html">
              <div>
                <p>STORY</p>
                <p>我们的故事</p>
              </div>
            </a>
          </li>
          <li class="dropdown">
            <a href="./here.html" class="dropdown-toggle" >
              <div>
                <p>NEWS</p>
                <p>资讯在浙里</p>
              </div>
                <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
              <li><a href="./activities.html">最新活动</a></li>
              <li><a href="./news.html">壳牌洞察</a></li>
              <li><a href="./oilsitemap.html">油站分布</a></li>
            </ul>
          </li>
          <li>
            <a href="./product.html">
              <div>
                <p>PRODUCT</p>
                <p>产品与服务</p>
              </div>
            </a>
          </li>
          <li>
            <a href="./about.html">
              <div>
                <p>CAREERS</p>
                <p>壳动人才</p>
              </div>
            </a>
          </li>
          <li>
            <a href="./questions.html">
              <div>
                <p>Q&A</p>
                <p>问题与回答</p>
              </div>
            </a>
          </li>
          <li>
            <a href="./map.html">
              <div>
                <p>MAP</p>
                <p>地图分布</p>
              </div>
            </a>
          </li>
        </ul>
      </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
  </nav>
  <script src="./js/jquery.min-1.12.1.js"></script>
  <script src="./bootstrap/js/bootstrap.min.js"></script>
  <script src="./js/swiper.jquery.min.js"></script>
  <script>
    $(function(){
      // 检测该视频是否可以播放
      var getVideoCanPlay = function (video){
        return new Promise(resolve => {
          if(!video.readyState){
            video.oncanplay = () => {
              // console.log('play')
              resolve(video)
            }
          }else {
            resolve(video)
          }
        })
      };
      // 监听该视频是否已经播放完
      var VideoPlayEnd = video => new Promise(resolve => {
        var videoMonitor = null;
        videoMonitor = setInterval(() => {
          if(video.ended){
            clearInterval(videoMonitor);
            videoMonitor = null;
            resolve && resolve();
          }
        })
      });
      // 创建滑动组件
      var swiper = new Swiper('.swiper-container', {
        pagination: '.swiper-pagination',
        direction: 'vertical',
        slidesPerView: 1,
        paginationClickable: false,
        spaceBetween: 30,
        mousewheelControl: true,
        effect: 'fade',
        fade: {crossFade: true},
        onInit: function (){
          var oVideo = document.getElementById('video0');
          getVideoCanPlay(oVideo).then((video) => {
            video.play();
          });
          VideoPlayEnd(oVideo).then(() => {
            $('.swiper-container').find('.swiper-slide-active').find('img').fadeIn('slow');
          })
        },
        onSlideChangeEnd: function(swiper){
          var isReverse = swiper.activeIndex - swiper.previousIndex < 0;
          var currentVideoIndex = !isReverse ? swiper.activeIndex + 1 : swiper.activeIndex;
          var nextVideo = document.getElementById('video' + swiper.activeIndex);
          var prevVideo = document.getElementById('reversevideo' + swiper.previousIndex);
          swiper.lockSwipes();
          $('.swiper-container').find('.swiper-slide').eq(swiper.previousIndex).find('img').hide();
          if(!isReverse){
            $('.videos').find('video').eq(swiper.activeIndex).show().siblings().hide();
            getVideoCanPlay(nextVideo).then(video => {
              video.play();
            });
            VideoPlayEnd(nextVideo).then(() => {
              $('.swiper-container').find('.swiper-slide-active').find('img').fadeIn('slow');
              swiper.unlockSwipes();
            });
          }else {
            $('.videos').find('.reversevideo').eq(swiper.previousIndex).show().siblings().hide();
            getVideoCanPlay(prevVideo).then(video => {
              video.play();
            });
            VideoPlayEnd(prevVideo).then(() => {
              $('.swiper-container').find('.swiper-slide-active').find('img').fadeIn('slow');
              swiper.unlockSwipes();
            })
          }
        }
      });
    })
  </script>
</body>
</html>
